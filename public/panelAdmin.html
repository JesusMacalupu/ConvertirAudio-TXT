<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Panel de administrador estático para pruebas de diseño, con opciones para gestionar usuarios, transcripciones y configuraciones.">
    <title>Panel de Administrador</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Animaciones */
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .animate-fadeInScale {
            animation: fadeInScale 0.5s ease-out forwards;
        }

        .animate-scaleIn {
            animation: scaleIn 0.3s ease-out forwards;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .spinner {
            border: 6px solid rgba(255, 255, 255, 0.989);
            border-top: 6px solid #F97316;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            animation: spin 0.7s linear infinite;
            margin: 1rem auto;
        }

        .neumorphic-card {
            background: #1E293B;
            box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.4),
                -8px -8px 16px rgba(255, 255, 255, 0.05);
            border: 2px solid #F97316;
            border-radius: 1rem;
            transition: none;
        }

        .icon-admin {
            transition: opacity 0.5s ease;
        }

        .btn {
            transition: all 0.3s ease;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
        }

        .logout-btn {
            transition: all 0.3s ease;
        }

        .logout-btn:hover:not(:disabled) {
            background-color: #B91C1C;
        }

        body {
            background: linear-gradient(135deg, #0F172A 0%, #9A3412 100%);
            position: relative;
            overflow-x: hidden;
        }

        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            animation: float 10s infinite ease-in-out;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        #alertModal,
        #topUsersModal,
        #transcriptionModal,
        #userModal,
        #deleteConfirmModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
        }

        #alertMessage {
            background: #F97316;
            padding: 1.5rem 2rem;
            border-radius: 0.5rem;
            text-align: center;
            max-width: 90%;
            width: 400px;
            box-shadow: 0 0 25px rgba(249, 115, 22, 0.4);
            font-size: 1.25rem;
            font-weight: bold;
            color: black;
            white-space: pre-wrap;
        }

        #transcriptionModalContent {
            background: #1E293B;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 0 25px rgba(249, 115, 22, 0.4);
            border: 3px solid #F97316;
            max-width: 90%;
            width: 500px;
            position: relative;
        }

        #userModalContent,
        #deleteConfirmModalContent {
            background: linear-gradient(145deg, #1E293B 0%, #2D3748 100%);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 10px 10px 20px rgba(0, 0, 0, 0.5), -10px -10px 20px rgba(255, 255, 255, 0.05);
            border: 3px solid #F97316;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            animation: fadeInScale 0.3s ease-out;
            position: relative;
            overflow-y: auto;
        }

        #deleteConfirmModalContent {
            max-width: 400px;
            text-align: center;
        }

        #transcriptionModalContent h3,
        #userModalContent h3,
        #deleteConfirmModalContent h3 {
            color: #F97316;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 0.5rem;
        }

        #transcriptionText {
            width: 100%;
            min-height: 200px;
            padding: 0.75rem;
            border: 2px solid #F97316;
            border-radius: 0.5rem;
            background: #2D3748;
            color: #D1D5DB;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            outline: none;
            resize: none;
        }

        #transcriptionText:focus {
            border-color: #EA580C;
            box-shadow: 0 0 10px rgba(249, 115, 22, 0.4);
        }

        #transcriptionText::-webkit-scrollbar {
            width: 8px;
        }

        #transcriptionText::-webkit-scrollbar-track {
            background: #1E293B;
            border-radius: 4px;
        }

        #transcriptionText::-webkit-scrollbar-thumb {
            background: #F97316;
            border-radius: 4px;
        }

        #transcriptionText::-webkit-scrollbar-thumb:hover {
            background: #EA580C;
        }

        #userNameInput,
        #userEmailInput,
        #userPasswordInput {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #F97316;
            border-radius: 0.75rem;
            background: linear-gradient(145deg, #2D3748 0%, #1E293B 100%);
            color: #D1D5DB;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            outline: none;
            box-shadow: inset 4px 4px 8px rgba(0, 0, 0, 0.3), inset -4px -4px 8px rgba(255, 255, 255, 0.05);
            transition: border-color 0.3s ease;
        }

        #userNameInput.editing,
        #userEmailInput.editing,
        #userPasswordInput.editing {
            border-color: #10B981;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
        }

        #userNameInput:focus,
        #userEmailInput:focus,
        #userPasswordInput:focus {
            border-color: #EA580C;
            box-shadow: 0 0 10px rgba(249, 115, 22, 0.4);
        }

        #userNameInput.editing:focus,
        #userEmailInput.editing:focus,
        #userPasswordInput.editing:focus {
            border-color: #10B981;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
        }

        #userNameInput::selection,
        #userEmailInput::selection,
        #userPasswordInput::selection {
            background: transparent;
            color: inherit;
            text-decoration: none;
        }

        #userNameInput::-moz-selection,
        #userEmailInput::-moz-selection,
        #userPasswordInput::-moz-selection {
            background: transparent;
            color: inherit;
            text-decoration: none;
        }

        .modal-buttons {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .modal-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.3), -4px -4px 8px rgba(255, 255, 255, 0.05);
        }

        .copy-btn,
        .edit-btn,
        .save-btn {
            background: #F97316;
            color: black;
            border: none;
        }

        .save-btn {
            background: #10B981;
        }

        .copy-btn:hover,
        .edit-btn:hover,
        .save-btn:hover {
            background: #EA580C;
            transform: translateY(-2px);
        }

        .save-btn:hover {
            background: #059669;
        }

        .delete-btn,
        .confirm-delete-btn {
            background: #B91C1C;
            color: white;
            border: none;
        }

        .delete-btn:hover,
        .confirm-delete-btn:hover {
            background: #991B1B;
            transform: translateY(-2px);
        }

        .close-btn,
        .cancel-delete-btn {
            background: #6B7280;
            color: white;
            border: none;
        }

        .close-btn:hover,
        .cancel-delete-btn:hover {
            background: #4B5563;
            transform: translateY(-2px);
        }

        #copyMessage {
            display: none;
            background: #FFFFFF;
            color: black;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            text-align: center;
            font-size: 1rem;
            font-weight: bold;
            width: fit-content;
            margin: 0 auto;
            box-shadow: 0 0 10px rgba(249, 115, 22, 0.2);
            z-index: 1001;
            animation: scaleIn 0.3s ease-out;
        }

        #topUsersModalContent {
            background: linear-gradient(145deg, #1E293B 0%, #2D3748 100%);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 10px 10px 20px rgba(0, 0, 0, 0.5), -10px -10px 20px rgba(255, 255, 255, 0.05);
            border: 3px solid #F97316;
            max-width: 95%;
            width: 800px;
            position: relative;
            animation: fadeInScale 0.3s ease-out;
        }

        .close-modal-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            color: #F97316;
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.2s ease, transform 0.2s ease;
        }

        .close-modal-btn:hover {
            color: #EA580C;
            transform: scale(1.1);
        }

        .top-user-card {
            background: linear-gradient(145deg, #2D3748 0%, #1E293B 100%);
            border: 2px solid #F97316;
            border-radius: 1rem;
            padding: 1.25rem;
            text-align: center;
            transition: none;
        }

        .top-user-image {
            width: 80px;
            height: 80px;
            object-fit: contain;
            margin: 0 auto 1rem;
        }

        .chart-container {
            background: linear-gradient(145deg, #F5F5F5 0%, #FFF7ED 100%);
            border: 2px solid #F97316;
            border-radius: 1rem;
            padding: 1.25rem;
            box-shadow: 6px 6px 12px rgba(0, 0, 0, 0.4), -6px -6px 12px rgba(255, 255, 255, 0.05);
        }

        .chart-container h3 {
            color: #000000;
        }

        .sidebar {
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-logo-container {
            background-color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
        }

        .sidebar-logo {
            max-width: 100%;
            height: 3rem;
        }

        .sidebar-nav {
            flex: 1;
        }

        .sidebar-nav ul {
            list-style: none;
            padding: 0;
        }

        .sidebar-nav li {
            margin-bottom: 0.5rem;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            color: #D1D5DB;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .sidebar-nav a:not(.no-hover):hover {
            background-color: #F97316;
            color: white;
            transform: translateX(4px);
        }

        .sidebar-nav a.active {
            background-color: #EA580C;
            color: white;
            font-weight: 600;
        }

        .sidebar-nav i {
            width: 1.25rem;
            height: 1.25rem;
            color: #D1D5DB;
        }

        .sidebar-nav a:not(.no-hover):hover i,
        .sidebar-nav a.active i {
            color: white;
        }

        .logout-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
        }

        .welcome-text {
            color: #F97316;
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .card-info {
            max-width: 200px;
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
        }

        .clickable-card {
            cursor: pointer;
        }

        .users-table-container,
        .transcriptions-table-container {
            overflow-x: auto;
            position: relative;
            max-height: 400px;
            overflow-y: auto;
        }

        .users-table,
        .transcriptions-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: linear-gradient(145deg, #2D3748 0%, #1E293B 100%);
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .users-table th,
        .transcriptions-table th {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: black;
            font-size: 1rem;
            background: #F97316;
            font-weight: 700;
            position: sticky;
            top: 0;
            z-index: 10;
            text-transform: uppercase;
        }

        .users-table td,
        .transcriptions-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: #D1D5DB;
            font-size: 1rem;
        }

        .users-table tr:nth-child(even),
        .transcriptions-table tr:nth-child(even) {
            background: rgba(45, 55, 72, 0.8);
        }

        .users-table tr:hover,
        .transcriptions-table tr:hover {
            background: rgba(249, 115, 22, 0.2);
            transition: background 0.3s ease;
            cursor: pointer;
        }

        .users-table th:first-child,
        .users-table td:first-child,
        .transcriptions-table th:first-child,
        .transcriptions-table td:first-child {
            border-top-left-radius: 0.5rem;
            border-bottom-left-radius: 0.5rem;
        }

        .users-table th:last-child,
        .users-table td:last-child,
        .transcriptions-table th:last-child,
        .transcriptions-table td:last-child {
            border-top-right-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
        }

        .users-table-container::-webkit-scrollbar,
        .transcriptions-table-container::-webkit-scrollbar {
            width: 8px;
        }

        .users-table-container::-webkit-scrollbar-track,
        .transcriptions-table-container::-webkit-scrollbar-track {
            background: #1E293B;
        }

        .users-table-container::-webkit-scrollbar-thumb,
        .transcriptions-table-container::-webkit-scrollbar-thumb {
            background: #F97316;
            border-radius: 4px;
        }

        .users-table-container::-webkit-scrollbar-thumb:hover,
        .transcriptions-table-container::-webkit-scrollbar-thumb:hover {
            background: #EA580C;
        }

        .search-container,
        .filter-container {
            margin-bottom: 1.5rem;
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .search-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 2px solid #F97316;
            border-radius: 0.5rem;
            background: #1E293B;
            color: #D1D5DB;
            font-size: 1rem;
            outline: none;
            box-shadow: inset 4px 4px 8px rgba(0, 0, 0, 0.3), inset -4px -4px 8px rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }

        .filter-select {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 2px solid #F97316;
            border-radius: 0.5rem;
            background: #1E293B;
            color: #FFFFFF;
            font-size: 1rem;
            outline: none;
            box-shadow: inset 4px 4px 8px rgba(0, 0, 0, 0.3), inset -4px -4px 8px rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%23F97316" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5rem;
        }

        .search-input::placeholder,
        .filter-select::placeholder {
            color: #6B7280;
        }

        .search-input:focus,
        .filter-select:focus {
            border-color: #EA580C;
            box-shadow: 0 0 10px rgba(249, 115, 22, 0.4);
        }

        .filter-btn {
            background: #F97316;
            color: black;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: background 0.3s ease;
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.3), -4px -4px 8px rgba(255, 255, 255, 0.05);
            font-size: 1rem;
        }

        .filter-btn:hover {
            background: #EA580C;
        }

        .filter-select option {
            background: #1E293B;
            color: #FFFFFF;
        }

        .transcriptions-table td:nth-child(4) {
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .clickable {
            cursor: pointer;
        }

        /* Estilos para la sección de generación de reportes */
        .report-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .report-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .report-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            border: 2px solid #F97316;
            border-radius: 0.75rem;
            background: linear-gradient(145deg, #2D3748 0%, #1E293B 100%);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .report-option:hover {
            border-color: #EA580C;
            transform: translateY(-2px);
            box-shadow: 0 0 10px rgba(249, 115, 22, 0.4);
        }

        .report-option.selected {
            border-color: #10B981;
            background: linear-gradient(145deg, #2D3748 0%, #1E293B 100%);
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
        }

        .report-option input {
            display: none;
        }

        .report-option label {
            color: #D1D5DB;
            font-weight: 500;
            cursor: pointer;
            margin: 0;
            flex: 1;
        }

        /* Estilos para el botón de generar reporte */
        .generate-report-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            background: #B91C1C;
            color: white;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 4px 4px 8px rgba(0, 0, 0, 0.3), -4px -4px 8px rgba(255, 255, 255, 0.05);
            font-size: 1rem;
            margin-top: 1rem;
            margin-left: auto;
            margin-right: auto;
            width: 100%;
            max-width: 300px;
        }

        .generate-report-btn:hover {
            background: #991B1B;
            transform: translateY(-2px);
        }

        .generate-report-btn i.fa-file-pdf {
            font-size: 1.5rem;
            color: white;
        }

        @media (max-width: 640px) {
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                height: 100%;
                z-index: 1000;
            }

            #alertMessage,
            #deleteConfirmModalContent {
                padding: 1rem 1.5rem;
                width: 90%;
                max-width: 350px;
                font-size: 1rem;
            }

            #topUsersModalContent {
                width: 95%;
                padding: 1rem;
            }

            #transcriptionModalContent {
                width: 95%;
                padding: 1rem;
                max-width: 90%;
            }

            #userModalContent {
                width: 95%;
                padding: 1rem;
                max-width: 360px;
                gap: 0.75rem;
            }

            #userModalContent h3 {
                font-size: 1.25rem;
            }

            #userId,
            #userCreated {
                font-size: 0.875rem;
            }

            #userNameInput,
            #userEmailInput,
            #userPasswordInput {
                padding: 0.5rem;
                font-size: 0.875rem;
                border-radius: 0.5rem;
            }

            .form-group label {
                font-size: 0.875rem;
            }

            .modal-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }

            .modal-btn {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
                width: 100%;
                text-align: center;
            }

            .top-user-card {
                padding: 1rem;
            }

            .top-user-image {
                width: 60px;
                height: 60px;
            }

            .close-modal-btn {
                font-size: 1.25rem;
                top: 0.75rem;
                right: 0.75rem;
            }

            .sidebar-logo-container {
                padding: 0.75rem;
            }

            .sidebar-logo {
                height: 2.5rem;
            }

            .welcome-text {
                font-size: 1rem;
            }

            .chart-container canvas {
                max-height: 200px;
            }

            .users-table th,
            .users-table td,
            .transcriptions-table th,
            .transcriptions-table td {
                padding: 0.75rem;
                font-size: 0.875rem;
            }

            .search-input,
            .filter-select {
                padding: 0.5rem 0.75rem;
                font-size: 0.875rem;
            }

            .filter-select {
                background-position: right 0.25rem center;
            }

            .filter-btn {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
                width: auto;
            }

            .search-container,
            .filter-container {
                flex-direction: row;
                gap: 0.5rem;
            }

            .users-table-container,
            .transcriptions-table-container {
                max-height: 300px;
            }

            #transcriptionText {
                min-height: 150px;
                font-size: 0.875rem;
            }

            /* Responsive para generación de reportes */
            .report-options {
                grid-template-columns: 1fr;
            }

            .generate-report-btn i.fa-file-pdf {
                font-size: 1.25rem;
            }
        }

        @media (min-width: 640px) and (max-width: 768px) {

            #alertMessage,
            #deleteConfirmModalContent {
                padding: 1.25rem 1.75rem;
                width: 80%;
                max-width: 400px;
            }

            #topUsersModalContent {
                width: 90%;
                padding: 1.25rem;
            }

            #transcriptionModalContent {
                width: 90%;
                padding: 1.25rem;
                max-width: 500px;
            }

            #userModalContent {
                width: 90%;
                padding: 1.25rem;
                max-width: 450px;
            }

            #userModalContent h3 {
                font-size: 1.375rem;
            }

            #userId,
            #userCreated {
                font-size: 0.9375rem;
            }

            #userNameInput,
            #userEmailInput,
            #userPasswordInput {
                padding: 0.625rem;
                font-size: 0.9375rem;
            }

            .form-group label {
                font-size: 0.9375rem;
            }

            .modal-buttons {
                flex-direction: row;
                gap: 0.75rem;
            }

            .modal-btn {
                padding: 0.625rem 1.25rem;
                font-size: 0.9375rem;
            }

            .top-user-image {
                width: 70px;
                height: 70px;
            }

            .close-modal-btn {
                font-size: 1.5rem;
            }

            .sidebar-logo {
                height: 2.75rem;
            }

            .welcome-text {
                font-size: 1.125rem;
            }

            .chart-container canvas {
                max-height: 250px;
            }

            .users-table th,
            .users-table td,
            .transcriptions-table th,
            .transcriptions-table td {
                padding: 0.875rem;
            }

            .search-input,
            .filter-select {
                padding: 0.625rem 0.875rem;
                font-size: 1rem;
            }

            .filter-select {
                background-position: right 0.5rem center;
            }

            .filter-btn {
                padding: 0.625rem 1.25rem;
                font-size: 1rem;
            }

            .users-table-container,
            .transcriptions-table-container {
                max-height: 350px;
            }

            #transcriptionText {
                min-height: 180px;
            }

            /* Responsive para generación de reportes */
            .report-options {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 768px) {

            #alertMessage,
            #deleteConfirmModalContent {
                padding: 1.5rem 2rem;
                width: 400px;
            }

            #topUsersModalContent {
                width: 800px;
                padding: 1.5rem;
            }

            #transcriptionModalContent {
                width: 500px;
                padding: 1.5rem;
            }

            #userModalContent {
                width: 500px;
                padding: 1.5rem;
            }

            .top-user-image {
                width: 80px;
                height: 80px;
            }

            .sidebar-logo {
                height: 3rem;
            }

            .welcome-text {
                font-size: 1.25rem;
            }

            .chart-container canvas {
                max-height: 300px;
            }

            .users-table-container,
            .transcriptions-table-container {
                max-height: 400px;
            }

            /* Responsive para generación de reportes */
            .report-options {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            #topUsersModalContent {
                width: 800px;
                padding: 2rem;
            }

            #transcriptionModalContent {
                width: 500px;
                padding: 1.5rem;
            }

            #userModalContent {
                width: 500px;
                padding: 1.5rem;
            }

            .sidebar-logo {
                height: 3.5rem;
            }

            .welcome-text {
                font-size: 1.25rem;
            }

            .chart-container canvas {
                max-height: 350px;
            }

            /* Responsive para generación de reportes */
            .report-options {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 1023px) {
            .neumorphic-card {
                flex-direction: row;
                align-items: center;
                justify-content: flex-start;
                gap: 1rem;
                padding: 1rem;
                min-width: 250px;
            }

            .card-icon {
                order: 1;
                flex-shrink: 0;
            }

            .card-title {
                order: 2;
                text-align: left;
                margin-bottom: 0;
            }

            .card-info {
                order: 3;
                text-align: left;
                margin-bottom: 0;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (min-width: 1024px) {
            .charts-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        main {
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #F97316 #1E293B;
        }

        main::-webkit-scrollbar {
            width: 8px;
        }

        main::-webkit-scrollbar-track {
            background: #1E293B;
        }

        main::-webkit-scrollbar-thumb {
            background: #F97316;
            border-radius: 4px;
        }

        main::-webkit-scrollbar-thumb:hover {
            background: #EA580C;
        }

        .charts-grid,
        .grid {
            overflow: hidden;
        }

        @media (max-width: 767px) {
            main {
                padding: 1rem;
            }
        }
    </style>
</head>

<body class="h-screen overflow-hidden flex">
    <aside id="sidebar"
        class="sidebar fixed md:static top-0 left-0 h-full md:h-auto w-72 bg-gray-800/95 p-6 z-50 transform -translate-x-full md:translate-x-0 flex flex-col neumorphic">
        <div class="sidebar-header">
            <div id="welcomeMessage" class="welcome-text">Bienvenido</div>
            <div class="sidebar-logo-container">
                <img src="https://hrlatam.com/wp-content/uploads/2020/12/Logo-HR-LATAM-Horizontaltransparente.png"
                    alt="HR Latam Logo" class="sidebar-logo">
            </div>
        </div>
        <nav class="sidebar-nav">
            <ul>
                <li>
                    <a href="#" class="active">
                        <i class="fas fa-tachometer-alt"></i>
                        Estadísticas
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fas fa-users"></i>
                        Usuarios
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fas fa-file-alt"></i>
                        Historial de Transcripciones
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fas fa-chart-bar"></i>
                        Generación de Reportes
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fas fa-cog"></i>
                        Configuraciones
                    </a>
                </li>
            </ul>
        </nav>
        <button type="button" class="logout-btn w-full bg-red-600 text-white py-3 px-4 rounded-lg font-semibold mt-6"
            id="logoutBtn">
            <i class="fas fa-sign-out-alt mr-2"></i>
            Cerrar Sesión
        </button>
    </aside>

    <div id="overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden"></div>

    <div class="flex-1 flex flex-col overflow-hidden">
        <header class="flex items-center justify-between bg-gray-800/90 px-4 py-3 shadow-md z-10">
            <button id="menuToggle" class="md:hidden text-white focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
            <h1 class="text-lg sm:text-xl font-bold text-white">Sistema de Administración</h1>
            <div class="w-6 h-6"></div>
        </header>

        <main class="flex-1 overflow-auto p-4 sm:p-6 md:p-8 relative">
            <div class="particles"></div>
            <div class="container mx-auto max-w-5xl">
                <h2 class="text-2xl sm:text-3xl md:text-4xl font-extrabold text-white mb-4 sm:mb-6 animate-fadeInScale">
                    <center>Panel de Administrador</center>
                </h2>
                <div id="estadisticas" class="bg-gray-800/90 rounded-xl p-4 sm:p-6 neumorphic-card animate-fadeInScale">
                    <h3 class="text-white text-xl sm:text-2xl font-bold text-center mb-6">Estadísticas en Tiempo Real
                    </h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6">
                        <div
                            class="bg-gray-900/50 p-5 sm:p-6 rounded-lg neumorphic-card flex flex-col items-center justify-center">
                            <i class="fas fa-users text-orange-500 text-3xl sm:text-4xl mb-3 card-icon"></i>
                            <h3 class="text-2xl sm:text-3xl font-bold text-white mb-2 card-info text-center"
                                id="userCount">0</h3>
                            <p class="text-white text-sm sm:text-base text-center font-medium card-title">Total de
                                Usuarios</p>
                        </div>
                        <div
                            class="bg-gray-900/50 p-5 sm:p-6 rounded-lg neumorphic-card flex flex-col items-center justify-center">
                            <i class="fas fa-file-alt text-orange-500 text-3xl sm:text-4xl mb-3 card-icon"></i>
                            <h3 class="text-2xl sm:text-3xl font-bold text-white mb-2 card-info text-center"
                                id="transcriptionCount">0</h3>
                            <p class="text-white text-sm sm:text-base text-center font-medium card-title">Número de
                                Transcripciones</p>
                        </div>
                        <div class="bg-gray-900/50 p-5 sm:p-6 rounded-lg neumorphic-card flex flex-col items-center justify-center clickable-card"
                            id="topUsersCard">
                            <i class="fas fa-star text-orange-500 text-3xl sm:text-4xl mb-3 card-icon"></i>
                            <h3 class="text-xl sm:text-2xl font-bold text-white mb-2 card-info text-center">Top 3
                                Usuarios</h3>
                            <p class="text-white text-sm sm:text-base text-center font-medium card-title">Usuarios con
                                Más Transcripciones</p>
                        </div>
                        <div
                            class="bg-gray-900/50 p-5 sm:p-6 rounded-lg neumorphic-card flex flex-col items-center justify-center">
                            <i class="fas fa-clock text-orange-500 text-3xl sm:text-4xl mb-3 card-icon"></i>
                            <h3 class="text-xl sm:text-2xl font-bold text-white mb-2 card-info text-center"
                                id="latestTranscription">Cargando...</h3>
                            <p class="text-white text-sm sm:text-base text-center font-medium card-title">Última
                                Transcripción</p>
                        </div>
                    </div>
                    <div class="charts-grid grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mt-6">
                        <div class="chart-container neumorphic-card">
                            <h3 class="text-lg sm:text-xl font-bold text-center mb-4">Transcripciones por Día</h3>
                            <canvas id="barChart"></canvas>
                        </div>
                        <div class="chart-container neumorphic-card">
                            <h3 class="text-lg sm:text-xl font-bold text-center mb-4">Distribución de Transcripciones
                            </h3>
                            <canvas id="pieChart"></canvas>
                        </div>
                    </div>
                </div>
                <div id="usuarios"
                    class="bg-gray-800/90 rounded-xl p-4 sm:p-6 neumorphic-card animate-fadeInScale mt-6">
                    <h3 class="text-white text-xl sm:text-2xl font-bold text-center mb-6">Usuarios Registrados</h3>
                    <div class="search-container">
                        <input type="text" id="userSearch" class="search-input"
                            placeholder="Filtra por ID, Nombre o Correo...">
                        <button class="filter-btn">Filtrar</button>
                    </div>
                    <div class="users-table-container">
                        <div id="loadingSpinner" class="spinner hidden"></div>
                        <table class="users-table">
                            <thead>
                                <tr>
                                    <th>Id</th>
                                    <th>Nombre</th>
                                    <th>Correo</th>
                                    <th>Contraseña</th>
                                    <th>Fecha de registro</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="historial-de-transcripciones"
                    class="bg-gray-800/90 rounded-xl p-4 sm:p-6 neumorphic-card animate-fadeInScale mt-6">
                    <h3 class="text-white text-xl sm:text-2xl font-bold text-center mb-6">Historial de Transcripciones
                        en el Sistema</h3>
                    <div class="filter-container">
                        <select id="transcriptionFilter" class="filter-select">
                            <option value="">Selecciona un filtro</option>
                            <option value="recent">Transcripción más reciente</option>
                            <option value="oldest">Transcripción más antigua</option>
                            <option value="longest">Transcripción más larga</option>
                            <option value="mostTranscriptions">Usuario con más transcripciones</option>
                        </select>
                        <button class="filter-btn" id="applyTranscriptionFilter">Filtrar</button>
                    </div>
                    <div class="transcriptions-table-container">
                        <div id="transcriptionLoadingSpinner" class="spinner hidden"></div>
                        <table class="transcriptions-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre del Archivo</th>
                                    <th>Fecha de Subida</th>
                                    <th>Texto Transcrito</th>
                                    <th>Nombre del Usuario</th>
                                </tr>
                            </thead>
                            <tbody id="transcriptionsTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="generacion-de-reportes"
                    class="bg-gray-800/90 rounded-xl p-4 sm:p-6 neumorphic-card animate-fadeInScale mt-6">
                    <h3 class="text-white text-xl sm:text-2xl font-bold text-center mb-6">Generación de Reportes</h3>
                    <div class="report-form">
                        <div class="form-group">
                            <label class="block text-sm sm:text-base font-medium text-gray-200 mb-3">Tipo de
                                Reporte</label>
                            <div class="report-options">
                                <div class="report-option">
                                    <input type="radio" id="reportType1" name="reportType" value="estadisticas">
                                    <label for="reportType1">Estadísticas</label>
                                </div>
                                <div class="report-option">
                                    <input type="radio" id="reportType2" name="reportType" value="usuarios">
                                    <label for="reportType2">Usuarios</label>
                                </div>
                                <div class="report-option">
                                    <input type="radio" id="reportType3" name="reportType"
                                        value="historial-transcripciones">
                                    <label for="reportType3">Hist. de Transcripciones</label>
                                </div>
                                <div class="report-option">
                                    <input type="radio" id="reportType4" name="reportType" value="general">
                                    <label for="reportType4">General</label>
                                </div>
                            </div>
                        </div>
                        <button class="generate-report-btn" id="generateReportBtn">
                            <i class="fas fa-file-pdf"></i>
                            Generar Reporte
                        </button>
                    </div>
                </div>
                <div id="configuraciones" class="bg-gray-800/90 rounded-xl p-4 sm:p-6 neumorphic-card animate-fadeInScale mt-6">
    <h3 class="text-white text-xl sm:text-2xl font-bold text-center mb-6">Configuraciones</h3>
    <div class="flex flex-col md:flex-row gap-4 sm:gap-6">
        <!-- Lado izquierdo: Datos del Administrador -->
        <div class="w-full md:w-1/2 lg:w-[35%] flex flex-col items-center text-center">
            <h4 class="text-white font-bold text-base sm:text-lg mb-3 sm:mb-4">Datos del Administrador</h4>
            <i id="adminIcon" class="fas fa-user-shield text-orange-500 text-7xl sm:text-8xl md:text-9xl lg:text-10xl mb-3 sm:mb-4 icon-admin"></i>
            <p id="adminId" class="text-gray-300 text-sm sm:text-base mb-2">ID: Cargando...</p>
            <p id="adminRegistrationDate" class="text-gray-300 text-sm sm:text-base">Fecha de Registro: Cargando...</p>
        </div>
        <!-- Lado derecho: Formulario para cambiar datos -->
        <div class="w-full md:w-1/2 lg:w-[65%]">
            <form id="adminUpdateForm" class="flex flex-col gap-4">
                <div class="form-group">
                    <label for="adminNameInput" class="block text-sm sm:text-base font-medium text-gray-200 mb-1">Nombre completo</label>
                    <input id="adminNameInput" type="text" class="w-full p-2 border-2 border-orange-500 rounded-md bg-gray-800 text-white focus:border-orange-600 focus:outline-none">
                </div>
                <div class="form-group">
                    <label for="adminEmailInput" class="block text-sm sm:text-base font-medium text-gray-200 mb-1">Correo electronico</label>
                    <input id="adminEmailInput" type="email" class="w-full p-2 border-2 border-orange-500 rounded-md bg-gray-800 text-white focus:border-orange-600 focus:outline-none">
                </div>
                <div class="form-group">
                    <label for="adminPasswordInput" class="block text-sm sm:text-base font-medium text-gray-200 mb-1">Contraseña</label>
                    <input id="adminPasswordInput" type="password" class="w-full p-2 border-2 border-orange-500 rounded-md bg-gray-800 text-white focus:border-orange-600 focus:outline-none">
                </div>
            </form>
        </div>
    </div>
    <!-- Botón centrado para ambas secciones -->
    <div class="flex justify-center mt-4">
        <button type="submit" form="adminUpdateForm" class="bg-orange-500 text-black font-bold py-3 px-6 rounded-md hover:bg-orange-600 transition-all w-full md:w-auto lg:max-w-sm lg:min-w-[200px]">Cambiar Datos</button>
    </div>
</div>
            </div>
        </main>
    </div>

    <div id="alertModal">
        <div id="alertMessage"></div>
    </div>

    <div id="topUsersModal">
        <div id="topUsersModalContent" class="relative">
            <i class="fas fa-times close-modal-btn"></i>
            <h3 class="text-white text-2xl sm:text-3xl font-extrabold text-center mb-8">Top 3 Usuarios con Más
                Transcripciones</h3>
            <div id="topUsersList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
            </div>
        </div>
    </div>

    <div id="transcriptionModal">
        <div id="transcriptionModalContent">
            <h3 class="text-white font-bold text-center">Transcripción Completa</h3>
            <div id="copyMessage">Texto copiado al portapapeles</div>
            <div style="height: 0.5cm;"></div>
            <textarea id="transcriptionText" readonly></textarea>
            <div style="height: 0.5cm;"></div>
            <div class="modal-buttons">
                <button class="modal-btn copy-btn" id="copyTranscriptionBtn">Copiar</button>
                <button class="modal-btn close-btn" id="closeTranscriptionBtn">Cerrar</button>
            </div>
        </div>
    </div>

    <div id="userModal">
        <div id="userModalContent">
            <h3>Usuario en el Sistema</h3>
            <p id="userId" class="text-white text-sm sm:text-base text-center"></p>
            <p id="userCreated" class="text-white text-sm sm:text-base text-center mb-4"></p>
            <div class="form-group">
                <label for="userNameInput"
                    class="block text-sm sm:text-base font-medium text-gray-200 mb-1">Nombre</label>
                <input id="userNameInput" type="text" readonly class="w-full">
            </div>
            <div class="form-group">
                <label for="userEmailInput"
                    class="block text-sm sm:text-base font-medium text-gray-200 mb-1">Correo</label>
                <input id="userEmailInput" type="email" readonly class="w-full">
            </div>
            <div class="form-group">
                <label for="userPasswordInput"
                    class="block text-sm sm:text-base font-medium text-gray-200 mb-1">Contraseña</label>
                <input id="userPasswordInput" type="text" readonly class="w-full">
            </div>
            <div class="modal-buttons">
                <button class="modal-btn edit-btn" id="editUserBtn">Editar</button>
                <button class="modal-btn delete-btn" id="deleteUserBtn">Eliminar</button>
                <button class="modal-btn close-btn" id="closeUserBtn">Cerrar</button>
                <div style="height: 0.1cm;"></div>
            </div>
        </div>
    </div>

    <div id="deleteConfirmModal">
        <div id="deleteConfirmModalContent">
            <h3>Confirmar Eliminación</h3>
            <p id="deleteConfirmMessage" class="text-white text-sm sm:text-base text-center mb-4"></p>
            <div class="modal-buttons">
                <button class="modal-btn confirm-delete-btn" id="confirmDeleteBtn">Confirmar</button>
                <button class="modal-btn cancel-delete-btn" id="cancelDeleteBtn">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        (function () {
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.getElementById('menuToggle');
            const overlay = document.getElementById('overlay');
            const logoutBtn = document.getElementById('logoutBtn');
            const alertModal = document.getElementById('alertModal');
            const alertMessage = document.getElementById('alertMessage');
            const welcomeMessage = document.getElementById('welcomeMessage');
            const userCountElement = document.getElementById('userCount');
            const transcriptionCountElement = document.getElementById('transcriptionCount');
            const latestTranscriptionElement = document.getElementById('latestTranscription');
            const topUsersCard = document.getElementById('topUsersCard');
            const topUsersModal = document.getElementById('topUsersModal');
            const topUsersModalContent = document.getElementById('topUsersModalContent');
            const topUsersList = document.getElementById('topUsersList');
            const closeModalBtn = document.querySelector('.close-modal-btn');
            const userSearch = document.getElementById('userSearch');
            const filterBtn = document.querySelector('.filter-btn');
            const usersTableBody = document.getElementById('usersTableBody');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const transcriptionFilter = document.getElementById('transcriptionFilter');
            const applyTranscriptionFilter = document.getElementById('applyTranscriptionFilter');
            const transcriptionsTableBody = document.getElementById('transcriptionsTableBody');
            const transcriptionLoadingSpinner = document.getElementById('transcriptionLoadingSpinner');
            const transcriptionModal = document.getElementById('transcriptionModal');
            const transcriptionText = document.getElementById('transcriptionText');
            const copyTranscriptionBtn = document.getElementById('copyTranscriptionBtn');
            const closeTranscriptionBtn = document.getElementById('closeTranscriptionBtn');
            const copyMessage = document.getElementById('copyMessage');
            const userModal = document.getElementById('userModal');
            const userIdElement = document.getElementById('userId');
            const userCreatedElement = document.getElementById('userCreated');
            const userNameInput = document.getElementById('userNameInput');
            const userEmailInput = document.getElementById('userEmailInput');
            const userPasswordInput = document.getElementById('userPasswordInput');
            const editUserBtn = document.getElementById('editUserBtn');
            const deleteUserBtn = document.getElementById('deleteUserBtn');
            const closeUserBtn = document.getElementById('closeUserBtn');
            const deleteConfirmModal = document.getElementById('deleteConfirmModal');
            const deleteConfirmMessage = document.getElementById('deleteConfirmMessage');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
            const generateReportBtn = document.getElementById('generateReportBtn');
            const reportOptions = document.querySelectorAll('.report-option');

            let allUsers = [];
            let allTranscriptions = [];
            let selectedUser = null;

            const sectionMap = {
                'Estadísticas': 'estadisticas',
                'Usuarios': 'usuarios',
                'Historial de Transcripciones': 'historial-de-transcripciones',
                'Generación de Reportes': 'generacion-de-reportes',
                'Configuraciones': 'configuraciones'
            };

            function escapeHTML(str) {
                return str.replace(/[&<>"']/g, match => ({
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#39;'
                }[match]));
            }

            // Función para manejar la selección de tipo de reporte
            function handleReportOptionSelection() {
                reportOptions.forEach(option => {
                    const radio = option.querySelector('input[type="radio"]');
                    option.addEventListener('click', () => {
                        reportOptions.forEach(opt => opt.classList.remove('selected'));
                        option.classList.add('selected');
                        radio.checked = true;
                    });
                });
            }

            // Función para generar reporte
            async function generateReport() {
                const selectedReportType = document.querySelector('input[name="reportType"]:checked');

                if (!selectedReportType) {
                    showAlert('Por favor, selecciona un tipo de reporte');
                    return;
                }

                try {
                    const response = await fetch('/api/generate-report', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ type: selectedReportType.value })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'Error al generar reporte');
                    }

                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `reporte_${selectedReportType.value}.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                    window.URL.revokeObjectURL(url);

                    showAlert('Reporte generado exitosamente');
                } catch (err) {
                    console.error('Error generando reporte:', err);
                    showAlert('Error al generar el reporte: ' + err.message);
                }
            }

            // Vincular la función al botón
            document.addEventListener('DOMContentLoaded', () => {
                const generateReportBtn = document.getElementById('generateReportBtn');
                if (generateReportBtn) {
                    generateReportBtn.addEventListener('click', generateReport);
                } else {
                    console.error('Botón generateReportBtn no encontrado');
                }
            });

            async function fetchAdminName() {
                try {
                    const response = await fetch('/api/user');
                    if (!response.ok) throw new Error('Error al obtener datos del usuario');
                    const data = await response.json();
                    if (data.nombre && data.isAdmin) {
                        welcomeMessage.textContent = `Bienvenid@, ${data.nombre}`;
                    } else {
                        welcomeMessage.textContent = 'Bienvenido';
                    }
                } catch (err) {
                    console.error('Error fetching admin name:', err);
                    welcomeMessage.textContent = 'Bienvenido';
                    showAlert('Error al cargar el nombre del administrador');
                }
            }

            async function fetchUserCount() {
                try {
                    const response = await fetch('/api/users/count');
                    if (!response.ok) throw new Error('Error al obtener conteo de usuarios');
                    const data = await response.json();
                    userCountElement.textContent = data.count;
                } catch (err) {
                    console.error('Error fetching user count:', err);
                    userCountElement.textContent = 'Error';
                    showAlert('Error al cargar el conteo de usuarios');
                }
            }

            async function fetchTranscriptionCount() {
                try {
                    const response = await fetch('/api/transcriptions/count');
                    if (!response.ok) throw new Error('Error al obtener conteo de transcripciones');
                    const data = await response.json();
                    transcriptionCountElement.textContent = data.count;
                } catch (err) {
                    console.error('Error fetching transcription count:', err);
                    transcriptionCountElement.textContent = 'Error';
                    showAlert('Error al cargar el conteo de transcripciones');
                }
            }

            async function fetchLatestTranscription() {
                try {
                    const response = await fetch('/api/transcriptions/latest');
                    if (!response.ok) throw new Error('Error al obtener la última transcripción');
                    const data = await response.json();
                    latestTranscriptionElement.textContent = data.nombre_archivo;
                } catch (err) {
                    console.error('Error fetching latest transcription:', err);
                    latestTranscriptionElement.textContent = 'Error';
                    showAlert('Error al cargar la última transcripción');
                }
            }

            async function fetchTopUsers() {
                try {
                    const response = await fetch('/api/transcriptions/top-users');
                    if (!response.ok) throw new Error('Error al obtener los top usuarios');
                    const data = await response.json();
                    renderTopUsers(data);
                } catch (err) {
                    console.error('Error fetching top users:', err);
                    showAlert('Error al cargar los top usuarios');
                    renderTopUsers([]);
                }
            }

            async function fetchUsers() {
                try {
                    loadingSpinner.classList.remove('hidden');
                    const response = await fetch('/api/users');
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.details || errorData.error || 'Error al obtener usuarios');
                    }
                    const data = await response.json();
                    allUsers = data;
                    renderUsers(data);
                } catch (err) {
                    console.error('Error fetching users:', err);
                    usersTableBody.innerHTML = '<tr><td colspan="5" class="text-center text-gray-300">Error al cargar usuarios: ' + err.message + '</td></tr>';
                    showAlert('Error al cargar los usuarios: ' + err.message);
                } finally {
                    loadingSpinner.classList.add('hidden');
                }
            }

            async function fetchTranscriptions(filter = '') {
                try {
                    transcriptionLoadingSpinner.classList.remove('hidden');
                    const backendFilter = filter === 'longest' ? '' : filter;
                    const response = await fetch(`/api/transcriptions/all?filter=${backendFilter}`);
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.details || errorData.error || 'Error al obtener transcripciones');
                    }
                    let data = await response.json();

                    if (filter === '' || filter === 'longest') {
                        allTranscriptions = data;
                    }

                    if (filter === 'recent' && data.length > 0) {
                        data = [data[0]];
                    } else if (filter === 'oldest' && data.length > 0) {
                        data = [data[0]];
                    } else if (filter === 'longest' && data.length > 0) {
                        const longest = data.reduce((max, curr) => {
                            const maxLength = max.texto_transcrito ? max.texto_transcrito.length : 0;
                            const currLength = curr.texto_transcrito ? curr.texto_transcrito.length : 0;
                            return currLength > maxLength ? curr : max;
                        }, { texto_transcrito: '' });
                        data = longest.texto_transcrito ? [longest] : [];
                    } else if (filter === 'mostTranscriptions' && data.length > 0) {
                        const userCounts = data.reduce((acc, curr) => {
                            acc[curr.nombre_usuario] = (acc[curr.nombre_usuario] || 0) + 1;
                            return acc;
                        }, {});
                        const topUser = Object.keys(userCounts).reduce((a, b) =>
                            userCounts[a] > userCounts[b] ? a : b
                        );
                        data = data.filter(t => t.nombre_usuario === topUser);
                    }

                    renderTranscriptions(data);
                } catch (err) {
                    console.error('Error fetching transcriptions:', err);
                    transcriptionsTableBody.innerHTML = '<tr><td colspan="5" class="text-center text-gray-300">Error al cargar transcripciones: ' + err.message + '</td></tr>';
                    showAlert('Error al cargar las transcripciones: ' + err.message);
                } finally {
                    transcriptionLoadingSpinner.classList.add('hidden');
                }
            }

            function renderUsers(users) {
                usersTableBody.innerHTML = '';
                if (users.length === 0) {
                    usersTableBody.innerHTML = '<tr><td colspan="5" class="text-center text-gray-300">No hay usuarios disponibles</td></tr>';
                    return;
                }
                users.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                    <td>${escapeHTML(user.Id.toString())}</td>
                    <td>${escapeHTML(user.Nombre)}</td>
                    <td>${escapeHTML(user.Email)}</td>
                    <td>${escapeHTML(user.PasswordHash)}</td>
                    <td>${escapeHTML(user.FechaRegistro)}</td>
                `;
                    row.addEventListener('click', () => {
                        selectedUser = user;
                        userIdElement.textContent = `ID del usuario: ${escapeHTML(user.Id.toString())}`;
                        userCreatedElement.textContent = `Cuenta creada: ${escapeHTML(user.FechaRegistro)}`;
                        userNameInput.value = escapeHTML(user.Nombre);
                        userEmailInput.value = escapeHTML(user.Email);
                        userPasswordInput.value = escapeHTML(user.PasswordHash);
                        userNameInput.setAttribute('readonly', true);
                        userEmailInput.setAttribute('readonly', true);
                        userPasswordInput.setAttribute('readonly', true);
                        userNameInput.classList.remove('editing');
                        userEmailInput.classList.remove('editing');
                        userPasswordInput.classList.remove('editing');
                        editUserBtn.textContent = 'Editar';
                        editUserBtn.classList.remove('save-btn');
                        editUserBtn.classList.add('edit-btn');
                        userModal.style.display = 'flex';
                    });
                    usersTableBody.appendChild(row);
                });
            }

            function renderTranscriptions(transcriptions) {
                transcriptionsTableBody.innerHTML = '';
                if (transcriptions.length === 0) {
                    transcriptionsTableBody.innerHTML = '<tr><td colspan="5" class="text-center text-gray-300">No hay transcripciones disponibles</td></tr>';
                    return;
                }
                transcriptions.forEach(transcription => {
                    const truncatedText = transcription.texto_transcrito && transcription.texto_transcrito.length > 50
                        ? escapeHTML(transcription.texto_transcrito.substring(0, 50)) + '...'
                        : escapeHTML(transcription.texto_transcrito || '');
                    const row = document.createElement('tr');
                    row.innerHTML = `
                    <td>${escapeHTML(transcription.id_transcripcion.toString())}</td>
                    <td>${escapeHTML(transcription.nombre_archivo || '')}</td>
                    <td>${escapeHTML(transcription.fecha_subida || '')}</td>
                    <td class="clickable" data-text="${escapeHTML(transcription.texto_transcrito || '')}">${truncatedText}</td>
                    <td>${escapeHTML(transcription.nombre_usuario || '')}</td>
                `;
                    transcriptionsTableBody.appendChild(row);
                });

                document.querySelectorAll('.transcriptions-table .clickable').forEach(cell => {
                    cell.addEventListener('click', () => {
                        const fullText = cell.getAttribute('data-text');
                        transcriptionText.value = fullText;
                        transcriptionModal.style.display = 'flex';
                        copyMessage.style.display = 'none';
                    });
                });
            }

            function filterUsers(searchTerm) {
                if (!searchTerm) {
                    renderUsers(allUsers);
                    return;
                }
                const filteredUsers = allUsers.filter(user =>
                    user.Id.toString().toLowerCase().includes(searchTerm) ||
                    user.Nombre.toLowerCase().includes(searchTerm) ||
                    user.Email.toLowerCase().includes(searchTerm)
                );
                renderUsers(filteredUsers);
                if (filteredUsers.length === 0) {
                    usersTableBody.innerHTML = '<tr><td colspan="5" class="text-center text-gray-300">No se encontraron resultados</td></tr>';
                }
            }

            function renderTopUsers(users) {
                topUsersList.innerHTML = '';
                const medals = [
                    'img/medalla-de-oro.png',
                    'img/medalla-de-plata.png',
                    'img/medalla-de-bronce.png'
                ];
                if (users.length === 0) {
                    topUsersList.innerHTML = '<p class="text-gray-300 text-center">No hay datos disponibles</p>';
                    return;
                }
                users.forEach((user, index) => {
                    if (index < 3) {
                        const card = document.createElement('div');
                        card.className = 'top-user-card';
                        card.innerHTML = `
                        <img src="${medals[index]}" alt="Medalla ${index + 1}" class="top-user-image">
                        <h4 class="text-white font-extrabold text-xl mb-2">${escapeHTML(user.nombre_usuario)}</h4>
                        <p class="text-gray-300 text-base">Transcripciones: ${user.transcription_count}</p>
                    `;
                        topUsersList.appendChild(card);
                    }
                });
            }

            async function renderCharts() {
                try {
                    const response = await fetch('/api/transcriptions/daily');
                    if (!response.ok) throw new Error('Error al obtener transcripciones por día');
                    const data = await response.json();

                    const days = data.map(item => item.day);
                    const counts = data.map(item => item.count);
                    const total = counts.reduce((sum, count) => sum + count, 0);

                    const barChartCtx = document.getElementById('barChart').getContext('2d');
                    new Chart(barChartCtx, {
                        type: 'bar',
                        data: {
                            labels: days,
                            datasets: [{
                                label: 'Transcripciones por Día',
                                data: counts,
                                backgroundColor: '#F97316',
                                borderColor: '#EA580C',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Número de Transcripciones',
                                        color: '#000000',
                                        font: { size: 12 }
                                    },
                                    ticks: { color: '#000000' }
                                },
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Días de la Semana',
                                        color: '#000000',
                                        font: { size: 12 }
                                    },
                                    ticks: { color: '#000000' }
                                }
                            },
                            plugins: {
                                legend: {
                                    labels: { color: '#000000' }
                                }
                            }
                        }
                    });

                    const pieChartCtx = document.getElementById('pieChart').getContext('2d');
                    new Chart(pieChartCtx, {
                        type: 'pie',
                        data: {
                            labels: days,
                            datasets: [{
                                label: 'Distribución de Transcripciones',
                                data: counts,
                                backgroundColor: [
                                    '#F97316',
                                    '#EA580C',
                                    '#D1D5DB',
                                    '#9A3412',
                                    '#2D3748',
                                    '#1E293B',
                                    '#4B5563'
                                ],
                                borderColor: '#FFFFFF',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right',
                                    labels: {
                                        color: '#000000',
                                        font: { size: 12 },
                                        generateLabels: chart => {
                                            const data = chart.data;
                                            const total = data.datasets[0].data.reduce((sum, val) => sum + val, 0);
                                            return data.labels.map((label, i) => {
                                                const value = data.datasets[0].data[i];
                                                const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                                return {
                                                    text: `${label}: ${percentage}%`,
                                                    fillStyle: data.datasets[0].backgroundColor[i],
                                                    strokeStyle: data.datasets[0].borderColor[i],
                                                    lineWidth: data.datasets[0].borderWidth,
                                                    index: i
                                                };
                                            });
                                        }
                                    }
                                }
                            }
                        }
                    });
                } catch (err) {
                    console.error('Error fetching daily transcription data:', err);
                    showAlert('Error al cargar los datos de los gráficos');
                    const days = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'];
                    const counts = [0, 0, 0, 0, 0, 0, 0];

                    const barChartCtx = document.getElementById('barChart').getContext('2d');
                    new Chart(barChartCtx, {
                        type: 'bar',
                        data: {
                            labels: days,
                            datasets: [{
                                label: 'Transcripciones por Día',
                                data: counts,
                                backgroundColor: '#F97316',
                                borderColor: '#EA580C',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    title: {
                                        display: true,
                                        text: 'Número de Transcripciones',
                                        color: '#000000',
                                        font: { size: 12 }
                                    },
                                    ticks: { color: '#000000' }
                                },
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Días de la Semana',
                                        color: '#000000',
                                        font: { size: 12 }
                                    },
                                    ticks: { color: '#000000' }
                                }
                            },
                            plugins: {
                                legend: {
                                    labels: { color: '#000000' }
                                }
                            }
                        }
                    });

                    const pieChartCtx = document.getElementById('pieChart').getContext('2d');
                    new Chart(pieChartCtx, {
                        type: 'pie',
                        data: {
                            labels: days,
                            datasets: [{
                                label: 'Distribución de Transcripciones',
                                data: counts,
                                backgroundColor: [
                                    '#F97316',
                                    '#EA580C',
                                    '#D1D5DB',
                                    '#9A3412',
                                    '#2D3748',
                                    '#1E293B',
                                    '#4B5563'
                                ],
                                borderColor: '#FFFFFF',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right',
                                    labels: {
                                        color: '#000000',
                                        font: { size: 12 },
                                        generateLabels: chart => {
                                            return chart.data.labels.map((label, i) => ({
                                                text: `${label}: 0%`,
                                                fillStyle: chart.data.datasets[0].backgroundColor[i],
                                                strokeStyle: chart.data.datasets[0].borderColor[i],
                                                lineWidth: chart.data.datasets[0].borderWidth,
                                                index: i
                                            }));
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }

            async function updateUser() {
                if (!selectedUser) return;

                const updatedUser = {
                    Id: selectedUser.Id,
                    Nombre: userNameInput.value.trim(),
                    Email: userEmailInput.value.trim(),
                    PasswordHash: userPasswordInput.value.trim()
                };

                try {
                    const response = await fetch(`/api/users/${selectedUser.Id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(updatedUser)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.details || errorData.error || 'Error al actualizar usuario');
                    }

                    const data = await response.json();
                    showAlert(data.message || 'Usuario actualizado correctamente');
                    selectedUser = updatedUser;
                    await fetchUsers();
                } catch (err) {
                    console.error('Error updating user:', err);
                    showAlert('Error al actualizar el usuario: ' + err.message);
                }
            }

            async function deleteUser() {
                if (!selectedUser) return;

                try {
                    const response = await fetch(`/api/users/${selectedUser.Id}`, {
                        method: 'DELETE'
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.details || errorData.error || 'Error al eliminar usuario');
                    }

                    const data = await response.json();
                    showAlert(data.message || 'Usuario eliminado correctamente');
                    userModal.style.display = 'none';
                    deleteConfirmModal.style.display = 'none';
                    await fetchUsers();
                    selectedUser = null;
                } catch (err) {
                    console.error('Error deleting user:', err);
                    showAlert('Error al eliminar el usuario: ' + err.message);
                }
            }

            menuToggle.addEventListener('click', () => {
                sidebar.classList.toggle('-translate-x-full');
                overlay.classList.toggle('hidden');
            });

            overlay.addEventListener('click', () => {
                sidebar.classList.add('-translate-x-full');
                overlay.classList.add('hidden');
                topUsersModal.style.display = 'none';
                transcriptionModal.style.display = 'none';
                userModal.style.display = 'none';
                deleteConfirmModal.style.display = 'none';
            });

            document.querySelectorAll('.sidebar-nav a').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.querySelectorAll('.sidebar-nav a').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    const sectionId = sectionMap[item.textContent.trim()];
                    if (sectionId) {
                        const section = document.getElementById(sectionId);
                        if (section) {
                            section.scrollIntoView({ behavior: 'smooth' });
                        }
                    }
                    if (window.innerWidth < 768) {
                        sidebar.classList.add('-translate-x-full');
                        overlay.classList.add('hidden');
                    }
                });
            });

            logoutBtn.addEventListener('click', async () => {
                try {
                    const response = await fetch('/api/user');
                    if (!response.ok) throw new Error('Error al obtener datos del usuario');
                    const data = await response.json();
                    const nombre = data.nombre || 'Administrador';
                    const logoutResponse = await fetch('/api/logout', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' }
                    });
                    const logoutData = await logoutResponse.json();
                    showAlert(logoutData.message || `Sesión cerrada correctamente, ${nombre}`);
                    setTimeout(() => {
                        window.location.href = '/login.html';
                    }, 2000);
                } catch (err) {
                    console.error('Error during logout:', err);
                    showAlert('Error al cerrar sesión');
                    setTimeout(() => {
                        window.location.href = '/login.html';
                    }, 2000);
                }
            });

            function showAlert(message) {
                alertMessage.textContent = message;
                alertModal.style.display = 'flex';
                setTimeout(() => {
                    alertModal.style.display = 'none';
                }, 4000);
            }

            alertModal.addEventListener('click', () => {
                alertModal.style.display = 'none';
            });

            topUsersCard.addEventListener('click', () => {
                topUsersModal.style.display = 'flex';
                fetchTopUsers();
            });

            closeModalBtn.addEventListener('click', () => {
                topUsersModal.style.display = 'none';
            });

            topUsersModal.addEventListener('click', (e) => {
                if (e.target === topUsersModal) {
                    topUsersModal.style.display = 'none';
                }
            });

            function showCopyMessage(message) {
                copyMessage.textContent = message;
                copyMessage.style.display = 'block';
                setTimeout(() => {
                    copyMessage.style.display = 'none';
                }, 2000);
            }

            copyTranscriptionBtn.addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(transcriptionText.value);
                    showCopyMessage('Texto copiado al portapapeles');
                } catch (err) {
                    console.error('Error al copiar texto:', err);
                    showCopyMessage('Error al copiar el texto');
                }
            });

            closeTranscriptionBtn.addEventListener('click', () => {
                transcriptionModal.style.display = 'none';
            });

            transcriptionModal.addEventListener('click', (e) => {
                if (e.target === transcriptionModal) {
                    transcriptionModal.style.display = 'none';
                }
            });

            editUserBtn.addEventListener('click', async () => {
                if (editUserBtn.textContent === 'Editar') {
                    userNameInput.removeAttribute('readonly');
                    userEmailInput.removeAttribute('readonly');
                    userPasswordInput.removeAttribute('readonly');
                    userNameInput.classList.add('editing');
                    userEmailInput.classList.add('editing');
                    userPasswordInput.classList.add('editing');
                    editUserBtn.textContent = 'Guardar';
                    editUserBtn.classList.remove('edit-btn');
                    editUserBtn.classList.add('save-btn');
                } else {
                    userNameInput.classList.remove('editing');
                    userEmailInput.classList.remove('editing');
                    userPasswordInput.classList.remove('editing');
                    const updatedUser = {
                        Nombre: userNameInput.value,
                        Email: userEmailInput.value,
                        PasswordHash: userPasswordInput.value
                    };

                    try {
                        const response = await fetch(`/api/users/${selectedUser.Id}`, {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(updatedUser)
                        });
                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.details || errorData.error || 'Error al actualizar usuario');
                        }
                        const data = await response.json();
                        showAlert(data.message);
                        allUsers = allUsers.map(user => user.Id === selectedUser.Id ? { ...user, ...updatedUser } : user);
                        renderUsers(allUsers);
                        userNameInput.setAttribute('readonly', true);
                        userEmailInput.setAttribute('readonly', true);
                        userPasswordInput.setAttribute('readonly', true);
                        editUserBtn.textContent = 'Editar';
                        editUserBtn.classList.remove('save-btn');
                        editUserBtn.classList.add('edit-btn');
                        userModal.style.display = 'none';
                    } catch (err) {
                        console.error('Error updating user:', err);
                        showAlert('Error al actualizar usuario: ' + err.message);
                    }
                }
            });

            // Add event listeners to remove editing class on blur
            [userNameInput, userEmailInput, userPasswordInput].forEach(input => {
                input.addEventListener('blur', () => {
                    if (!input.hasAttribute('readonly')) {
                        input.classList.add('editing');
                    }
                });
                input.addEventListener('focus', () => {
                    if (!input.hasAttribute('readonly')) {
                        input.classList.add('editing');
                    }
                });
            });

            // Remove editing class when clicking outside the inputs
            document.addEventListener('click', (e) => {
                if (!userModal.contains(e.target) && userModal.style.display === 'flex') {
                    if (!userNameInput.hasAttribute('readonly')) {
                        userNameInput.classList.remove('editing');
                    }
                    if (!userEmailInput.hasAttribute('readonly')) {
                        userEmailInput.classList.remove('editing');
                    }
                    if (!userPasswordInput.hasAttribute('readonly')) {
                        userPasswordInput.classList.remove('editing');
                    }
                }
            });

            deleteUserBtn.addEventListener('click', () => {
                deleteConfirmMessage.textContent = `¿Estás seguro de eliminar la cuenta del usuario ${selectedUser.Nombre}?`;
                deleteConfirmModal.style.display = 'flex';
            });

            confirmDeleteBtn.addEventListener('click', async () => {
                try {
                    const response = await fetch(`/api/users/${selectedUser.Id}`, {
                        method: 'DELETE'
                    });
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.details || errorData.error || 'Error al eliminar usuario');
                    }
                    const data = await response.json();
                    showAlert(data.message);
                    allUsers = allUsers.filter(user => user.Id !== selectedUser.Id);
                    renderUsers(allUsers);
                    deleteConfirmModal.style.display = 'none';
                    userModal.style.display = 'none';
                    fetchUserCount();
                } catch (err) {
                    console.error('Error deleting user:', err);
                    showAlert('Error al eliminar usuario: ' + err.message);
                }
            });

            cancelDeleteBtn.addEventListener('click', () => {
                deleteConfirmModal.style.display = 'none';
            });

            closeUserBtn.addEventListener('click', () => {
                userNameInput.classList.remove('editing');
                userEmailInput.classList.remove('editing');
                userPasswordInput.classList.remove('editing');
                userModal.style.display = 'none';
            });

            userModal.addEventListener('click', (e) => {
                if (e.target === userModal) {
                    userNameInput.classList.remove('editing');
                    userEmailInput.classList.remove('editing');
                    userPasswordInput.classList.remove('editing');
                    userModal.style.display = 'none';
                }
            });

            deleteConfirmModal.addEventListener('click', (e) => {
                if (e.target === deleteConfirmModal) {
                    deleteConfirmModal.style.display = 'none';
                }
            });

            filterBtn.addEventListener('click', () => {
                const searchTerm = userSearch.value.trim().toLowerCase();
                if (!searchTerm) {
                    showAlert('Ingresa un valor para filtrar');
                    return;
                }
                filterUsers(searchTerm);
            });

            userSearch.addEventListener('input', () => {
                const searchTerm = userSearch.value.trim().toLowerCase();
                filterUsers(searchTerm);
            });

            applyTranscriptionFilter.addEventListener('click', () => {
                const filterValue = transcriptionFilter.value;
                if (!filterValue && filterValue !== '') {
                    showAlert('Selecciona un filtro');
                    return;
                }
                fetchTranscriptions(filterValue);
            });

            function handleReportOptionSelection() {
                const reportOptions = document.querySelectorAll('.report-option');
                reportOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        // Remove 'selected' class from all options
                        reportOptions.forEach(opt => opt.classList.remove('selected'));
                        // Add 'selected' class to the clicked option
                        option.classList.add('selected');
                        // Check the corresponding radio input
                        const radio = option.querySelector('input[type="radio"]');
                        radio.checked = true;
                    });
                });
            }

            const icons = ['fa-user-shield', 'fa-user-cog', 'fa-user-lock', 'fa-user-check'];
            let currentIconIndex = 0;
            const adminIconEl = document.getElementById('adminIcon');

            function changeAdminIcon() {
                adminIconEl.style.opacity = 0;
                setTimeout(() => {
                    adminIconEl.classList.remove(icons[currentIconIndex]);
                    currentIconIndex = (currentIconIndex + 1) % icons.length;
                    adminIconEl.classList.add(icons[currentIconIndex]);
                    adminIconEl.style.opacity = 1;
                }, 500);
            }
            setInterval(changeAdminIcon, 3500);

            fetchAdminName();
            fetchUserCount();
            fetchTranscriptionCount();
            fetchLatestTranscription();
            fetchTopUsers();
            fetchUsers();
            fetchTranscriptions();
            renderCharts();
            handleReportOptionSelection();
        })();
    </script>
</body>

</html>